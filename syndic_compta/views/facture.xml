<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
        <record model="ir.ui.view" id="syndic_facture_search">
            <field name="name">Syndic Facture Search</field>
            <field name="model">syndic.facturation</field>
            <field name="arch" type="xml">
                <search>
                    <filter string="payé"
                            domain="[ ('state', '=', 'close')]"
                            name="facture_close"/>
                    <filter string="Brouillon"
                            domain="[ ('state', '=', 'draft')]"
                            name="facture_draft"/>
                    <filter string="Validé"
                            domain="[ ('state', '=', 'validate')]"
                            name="facture_validate"/>
                </search>
            </field>
        </record>

         <record model="ir.ui.view" id="syndic_facture_form">
            <field name="name">Syndic Facture Form</field>
            <field name="model">syndic.facturation</field>
            <field name="priority">1</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="validate_facture" type="object" string="Validé" states="draft,report"/>
                        <button name="reset_draft" type="object" string="Remettre en brouillon" states="validate"/>
                        <button name="pay_all_facture" type="object"
                                string="Payer toute la facture" states="validate"/>
                        <button string="Imprimer" name="report_creation" type="object"/>
                        <field name="state" widget="statusbar"/>
                    </header>
                    <group>
                        <field name="name" readonly="1"/>
                        <field name="immeuble_id" attrs="{'readonly':[('state', '!=','draft')]}"/>
                        <field name="invoice_date" attrs="{'readonly':[('state', '!=','draft')]}"/>
                        <field name="exercice_id" domain="[('immeuble_id', '=', immeuble_id)]"/>
                        <field name="pay_percentage" widget="progressbar"/>
                        <field name="communication"/>
                    </group>
                    <notebook>
                        <page string="Ligne de facture">
                            <field name="line_ids" attrs="{'readonly':[('state', '!=','draft')]}">
                                <tree editable="top">
                                    <field name="type_id"/>
                                    <field name="name"/>
                                    <field name="prix"/>
                                    <!--<field name="invoice_line_date"/>-->
                                    <field name="fournisseur_id"/>
                                    <field name="repartition_lot_id" domain="[('immeuble_id', '=', immeuble_id)]"/>
                                    <field name="immeuble_id" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Detail de la facture">
                            <field name="facture_detail_ids" readonly="1">
                                <tree>
                                    <field name="facture_line_id"/>
                                    <field name="amount"/>
                                    <field name="lot_id"/>
                                    <field name="product_id"/>
                                    <field name="proprietaire_ids" widget='many2many_tags'/>
                                    <field name="fournisseur_id"/>
                                    <field name='is_paid'/>
                                    <field name='is_amortissable' />
                                    <field name='is_report' />
                                    <field name='is_amortissement' attrs="{'invisible':[('is_paid', '!=', True)]}"/>
                                    <field name='already_pay'/>
                                    <button name='pay_all' string="Payé totalité" type="object"
                                            attrs="{'invisible':['|', ('is_paid', '=', True), '|', ('is_report', '=', True), ('already_pay', '>', 0.00)]}"/>
                                    <button name='split_pay_wizard' string="Payé partiel" type="object"
                                            attrs="{'invisible':['|',('is_paid', '=', True), ('is_report', '=', True)]}"/>
                                    <button name='report_pay' string="report Payement" type="object"
                                            attrs="{'invisible':['|', ('is_report', '=', True), ('is_paid', '=', True)]}"/>
                                    <field name="report_facture_id" attrs="{'invisible':[('is_report', '!=', True)]}"/>
                                    <button name='amortissement_wizard' string="Amortir" type="object"
                                            attrs="{'invisible':['|', ('is_report', '=', False), ('is_paid', '=', False), ('is_amortissable', '=', False)]}"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <separator colspan="4" string="Ecritures comptables"/>
                    <field name="bilan_ids">
                        <tree editable="top">
                            <field name="name"/>
                            <field name="account_id"/>
                            <field name="debit"/>
                            <field name="credit"/>
                        </tree>
                    </field>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="syndic_detail_lot_tree">
            <field name="name">Syndic detail TREE</field>
            <field name="model">syndic.facture.detail</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="facture_line_id"/>
                    <field name="amount"/>
                    <field name="lot_id"/>
                    <field name="product_id"/>
                    <field name="proprietaire_ids" widget='many2many_tags'/>
                    <field name="fournisseur_id"/>
                    <field name='is_paid'/>
                    <field name='is_amortissement'/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="syndic_facture_detail_graph">
            <field name="name">Syndic repartition lot detail graph</field>
            <field name="model">syndic.facture.detail</field>
            <field name="arch" type="xml">
                <graph string="Details comptabilité" type="bar">
                    <field name="fournisseur_id"/>
                    <field name="amount" operator="+"/>
                </graph>
            </field>
        </record>

        <record model="ir.ui.view" id="syndic_facture_detail_form">
            <field name="name">Syndic repartition lot detail form</field>
            <field name="model">syndic.facture.detail</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="facture_id"/>
                        <field name="facture_line_id"/>
                        <field name="amount"/>
                        <field name="lot_id"/>
                        <field name="product_id"/>
                        <field name="proprietaire_ids"/>
                        <field name="fournisseur_id"/>
                        <field name="is_paid"/>
                        <field name="is_amortissement"/>
                        <field name='already_pay'/>
                        <field name='report_facture_id'/>
                        <field name="amortissement_ids"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="syndic_facture_detail_search">
            <field name="name">Syndic repartition lot detail search</field>
            <field name="model">syndic.facture.detail</field>
            <field name="arch" type="xml">
                <search>
                    <field name="facture_id"/>
                    <field name="exercice_id"/>
                    <field name="facture_line_id"/>
                    <field name="amount"/>
                    <field name="lot_id"/>
                    <field name="product_id"/>
                    <field name="proprietaire_ids"/>
                    <field name="fournisseur_id"/>
                    <field name="is_paid"/>
                    <field name="is_amortissement"/>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="syndic_split_pay_wizard">
            <field name="name">Syndic split pay wizard</field>
            <field name="model">syndic.compta.split.pay.wizard</field>
            <field name="arch" type="xml">
                <form>
                    <group>
                        <field name="amount"/>
                    </group>
                    <footer>
                        <button name="split_pay" string="payement partiel" type="object"/>
                    </footer>
                </form>
            </field>
        </record>

        <record model="ir.actions.act_window" id="action_facture">
            <field name="name">Syndic Facture</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">syndic.facturation</field>
            <field name="view_mode">tree,form</field>
        </record>
        <menuitem name="Factures" id="facture_encode" parent="facture" action="action_facture"/>

        <record model="ir.actions.act_window" id="action_detail_facture">
            <field name="name">Syndic details factures</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">syndic.facture.detail</field>
            <field name="view_mode">tree,form,graph</field>
        </record>
        <menuitem name="Details de factures" id="detail_facture"
                  parent="facture" action="action_detail_facture"/>

    </data>
</openerp>